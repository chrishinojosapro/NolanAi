<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Nolan Ai</title>

<!-- iOS PWA Support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="https://i.imgur.com/8Qp4R0K.png">

<style>
/* -------------------------------------------- */
/* THEME */
/* -------------------------------------------- */

:root {
  --bg:#000;
  --glass:rgba(25,25,25,0.8);
  --glass-border:rgba(255,255,255,0.12);
  --text:#fff;
  --muted:#9a9a9a;
  --accent:linear-gradient(135deg,#0A84FF,#BF5AF2);
  --ai:linear-gradient(135deg,#34C759,#30B0C7);
  --radius:22px;
  --pill:50px;
  --blur:40px;
  --font:-apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Arial;
}

* {
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
}

body {
  margin:0;
  background:var(--bg);
  font-family:var(--font);
  color:var(--text);
  height:100vh;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* Frosted glass */
.frost {
  background:var(--glass);
  border:1px solid var(--glass-border);
  backdrop-filter:blur(var(--blur)) saturate(150%);
  -webkit-backdrop-filter:blur(var(--blur)) saturate(150%);
}

/* -------------------------------------------- */
/* LAYOUT */
/* -------------------------------------------- */

.app {
  max-width:900px;
  width:100%;
  height:100%;
  padding:14px;
  margin:auto;
  display:flex;
  flex-direction:column;
}

.topbar {
  padding:14px 18px;
  border-radius:var(--radius);
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.brand {
  display:flex;
  align-items:center;
  gap:14px;
}

/* ----- MATCHING CIRCLE HEADER ICON ----- */
.brand-icon {
  height:40px;
  width:40px;
  min-height:40px;
  min-width:40px;

  border-radius:50%;
  background:var(--ai);

  display:flex;
  justify-content:center;
  align-items:center;

  font-weight:700;
  font-size:1.1rem;
  color:#fff;

  box-shadow:0 4px 12px rgba(0,0,0,0.35);
}

.brand h1 {
  margin:0;
  font-size:1.25rem;
  background:var(--accent);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.status {
  font-size:.75rem;
  padding:4px 12px;
  border-radius:20px;
  background:rgba(52,199,89,0.18);
  border:1px solid rgba(52,199,89,0.3);
  color:#a0ffbf;
}

#refresh {
  height:40px;
  width:40px;
  border-radius:50%;
  border:none;
  background:var(--glass);
  border:1px solid var(--glass-border);
  color:#fff;
  font-size:1.2rem;
  cursor:pointer;
}

/* -------------------------------------------- */
/* CHAT LAYOUT */
/* -------------------------------------------- */

#chat {
  flex:1;
  display:flex;
  flex-direction:column;
  border-radius:var(--radius);
  overflow:hidden;
}

#log {
  flex:1;
  padding:20px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* -------------------------------------------- */
/* MESSAGES */
/* -------------------------------------------- */

.msg {
  display:flex;
  align-items:flex-start;
  gap:10px;
  max-width:85%;
}

.msg.user {
  align-self:flex-end;
  flex-direction:row-reverse;
}

/* ----- MATCHING CIRCLE CHAT AVATARS ----- */
.avatar {
  height:40px;
  width:40px;
  min-height:40px;
  min-width:40px;

  border-radius:50%;
  flex-shrink:0;

  background:var(--ai);
  display:flex;
  justify-content:center;
  align-items:center;

  font-weight:700;
  font-size:1rem;
  color:#fff;

  box-shadow:0 4px 12px rgba(0,0,0,0.35);
}

.user .avatar {
  background:var(--accent);
}

.bubble {
  padding:12px 18px;
  font-size:.95rem;
  line-height:1.45;

  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:16px;

  max-width:85vw;
  word-wrap:break-word;
  overflow-wrap:break-word;
  white-space:normal;

  display:block;
}

.user .bubble {
  background:var(--accent);
  color:#fff;
}

/* Typing indicator */
#typing {
  padding:12px 20px;
  font-size:.85rem;
  color:var(--muted);
  display:none;
}

/* -------------------------------------------- */
/* INPUT BAR */
/* -------------------------------------------- */

.input-bar {
  padding:12px;
  display:flex;
  gap:10px;
  border-top:1px solid var(--glass-border);
}

#msg {
  flex:1;
  height:48px;
  border-radius:var(--pill);
  border:none;
  outline:none;
  padding:0 18px;
  background:rgba(255,255,255,0.08);
  color:#fff;
  font-size:1rem;
}

#send {
  height:48px;
  padding:0 24px;
  border:none;
  border-radius:var(--pill);
  background:var(--accent);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

@media(max-width:600px){
  #msg { height:44px; }
  #send { padding:0 18px; }
}

</style>
</head>

<body onload="initNolan()">

<div class="app">

  <div class="topbar frost">
    <div class="brand">
      <div class="brand-icon">N</div>
      <div>
        <h1>Nolan Ai</h1>
        <div style="font-size:.78rem; color:var(--muted); margin-top:-2px;">Personal Assistant</div>
      </div>
    </div>

    <div style="display:flex; gap:10px; align-items:center;">
      <button id="refresh">ðŸ”„</button>
      <div class="status">Online</div>
    </div>
  </div>

  <div id="chat" class="frost">
    <div id="log"></div>
    <div id="typing">Nolan is thinkingâ€¦</div>

    <div class="input-bar">
      <input id="msg" type="text" placeholder="Ask Nolan anythingâ€¦" autocomplete="off">
      <button id="send">Send</button>
    </div>
  </div>

</div>

<script>
/* -------------------------------------------- */
/* ENDPOINT */
/* -------------------------------------------- */

const API = "https://script.google.com/macros/s/AKfycbyme8N1SCc18K6GhRkf4ly-HNt6xq2qlLfz9tbvaskc1bbr_bMPxSSg6M9CggXumNnA/exec";

const log = document.getElementById("log");
const input = document.getElementById("msg");
const sendBtn = document.getElementById("send");
const typing = document.getElementById("typing");

/* -------------------------------------------- */
/* FALLBACK RESPONSES WHEN GEMINI FAILS */
/* -------------------------------------------- */

const fallback = [
  { k:["hello","hi"], r:"Hi Chris! ðŸ˜Š I'm here and ready." },
  { k:["status"], r:"I'm online and ready to help." },
  { k:["event","cab"], r:"Tell me the event name and Iâ€™ll help plan it. ðŸ“…" },
  { k:["email"], r:"Whoâ€™s this message for? I can draft it. âœ‰ï¸" },
  { k:["help"], r:"I'm right here. What do you need? ðŸ¤" }
];

function offlineReply(msg) {
  msg = msg.toLowerCase();
  for (let f of fallback) {
    if (f.k.some(k => msg.includes(k))) return f.r;
  }
  return "I'm here, Chris. What would you like to do next? âœ¨";
}

/* -------------------------------------------- */
/* RENDER MESSAGE */
/* -------------------------------------------- */

function addMsg(text, who) {
  const row = document.createElement("div");
  row.className = `msg ${who}`;

  const avatar = document.createElement("div");
  avatar.className = "avatar";
  avatar.textContent = who === "user" ? "C" : "N";

  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.innerHTML = text; // <â€“â€“ Proper rendering of paragraphs/emojis

  row.appendChild(avatar);
  row.appendChild(bubble);

  log.appendChild(row);
  log.scrollTop = log.scrollHeight;
}

/* -------------------------------------------- */
/* SEND MESSAGE */
/* -------------------------------------------- */

async function send() {
  const txt = input.value.trim();
  if (!txt) return;

  addMsg(txt, "user");

  input.value = "";
  input.disabled = true;
  sendBtn.disabled = true;
  typing.style.display = "block";

  try {
    const res = await fetch(API + "?q=" + encodeURIComponent(txt));
    const raw = await res.text();
    console.log("RAW:", raw);

    const data = JSON.parse(raw);
    addMsg(data.reply, "ai");

  } catch (err) {
    addMsg(offlineReply(txt), "ai");
  }

  typing.style.display = "none";
  input.disabled = false;
  sendBtn.disabled = false;
  input.focus();
}

/* -------------------------------------------- */
/* INIT â€” STARTUP BRIEFING */
/* -------------------------------------------- */

async function initNolan() {
  typing.style.display = "block";

  try {
    const res = await fetch(API + "?q=nolan_init");
    const raw = await res.text();
    console.log("INIT RAW:", raw);

    const data = JSON.parse(raw);
    addMsg(data.reply, "ai");

  } catch (err) {
    addMsg("Good morning Chris â˜€ï¸ I'm here whenever you need me.", "ai");
  }

  typing.style.display = "none";
  input.disabled = false;
  sendBtn.disabled = false;
  input.focus();
}

/* -------------------------------------------- */
/* EVENTS */
/* -------------------------------------------- */

sendBtn.addEventListener("click", send);
input.addEventListener("keypress", e => { if (e.key === "Enter") send(); });
document.getElementById("refresh").onclick = () => location.reload();

</script>

</body>
</html>
